# ATM Application - Банкомат

Приложение банкомата с функцией снятия денег, реализованное на Spring Boot 3.5 с использованием Java 21.

## Архитектура

Приложение следует принципам SOLID и использует следующую архитектуру:

- **Controller Layer**: REST API для взаимодействия с банкоматом
- **Service Layer**: Бизнес-логика обработки операций
- **Model Layer**: Модели данных с использованием Records и Lombok
- **Configuration**: Настройка и инициализация банкомата

## Основные возможности

- ✅ Снятие денег с оптимальным алгоритмом выдачи купюр
- ✅ Поддержка нескольких валют (RUB, USD, EUR)
- ✅ Thread-safe операции для многопоточной среды
- ✅ Валидация входных данных
- ✅ Централизованная обработка ошибок
- ✅ Подробное логирование операций
- ✅ Unit тесты

## API Endpoints

### 1. Снятие денег
```http
POST /api/atm/withdraw
Content-Type: application/json

{
    "currency": "RUB",
    "amount": 1500
}
```

**Ответ при успехе:**
```json
{
    "status": "SUCCESS",
    "requestedAmount": 1500,
    "dispensedAmount": 1500,
    "dispensedCash": {
        "Cash[currency=RUB, denomination=1000]": 1,
        "Cash[currency=RUB, denomination=500]": 1
    },
    "timestamp": "2024-01-15T10:30:00",
    "sessionId": "uuid-session-id"
}
```

### 2. Проверка баланса банкомата
```http
GET /api/atm/balance
```

**Ответ:**
```json
{
    "RUB": 95000,
    "USD": 3000,
    "EUR": 0
}
```

### 3. Проверка работоспособности
```http
GET /api/atm/health
```

**Ответ:**
```
OK
```

## Поддерживаемые валюты

- **RUB (Российский рубль)**: 5000₽, 1000₽, 500₽, 100₽
- **USD (Доллар США)**: $100, $50, $20, $10
- **EUR (Евро)**: готово к расширению

## Запуск приложения

### Требования
- Java 21+
- Gradle 8+

### Команды
```bash
# Запуск приложения
./gradlew bootRun

# Запуск тестов
./gradlew test

# Сборка
./gradlew build
```

## Архитектурные решения

### Thread Safety
- Использование `ConcurrentHashMap` для хранения инвентаря
- `ReentrantReadWriteLock` для безопасного доступа к данным
- Уникальные session ID для отслеживания операций

### Алгоритм выдачи денег
Реализован жадный алгоритм:
1. Сортировка купюр по убыванию номинала
2. Выбор максимального количества крупных купюр
3. Проверка возможности выдачи точной суммы
4. Атомарная операция выдачи с возможностью отката

### Расширяемость
- Легкое добавление новых валют через enum `Currency`
- Модульная архитектура сервисов
- Использование интерфейсов для возможного расширения

### Обработка ошибок
- Централизованный `@ControllerAdvice`
- Детальные статусы операций
- Логирование на разных уровнях

## Примеры использования

### Успешное снятие
```bash
curl -X POST http://localhost:8080/api/atm/withdraw \
  -H "Content-Type: application/json" \
  -d '{"currency":"RUB","amount":2600}'
```

### Проверка баланса
```bash
curl http://localhost:8080/api/atm/balance
```

## Тестирование

Проект включает unit тесты с использованием:
- JUnit 5
- Mockito
- AssertJ

Тесты покрывают основные сценарии:
- Успешное снятие денег
- Недостаточно средств в банкомате
- Невозможность выдать точную сумму

## Качество кода

- Соблюдение принципов SOLID
- Использование современных возможностей Java 21
- Применение Spring Boot best practices
- Подробная документация в коде
- Логирование всех важных операций 